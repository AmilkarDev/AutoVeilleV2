@model Autoveille.TestingModels.Client

<div class="row">
    <div class="col-md-4 col-lg-4">

        <div class="row">
            <div class="col-md-6 col-lg-6">

                <br class="brClient" />
                <div style="display:inline;text-align:left">
                    <text onclick="displayCalendar()" style="font-size:15px;font-weight:bolder;" data-toggle="modal" data-target="#myModal">RETOUR D'APPEL</text>
                    <img src="~/Content/Images/retourAppel.svg" height="20" width="20" style="margin-left:3px;" />

                </div>
                <br />
                <br />
                <text class="labell pleftClient">
                    Prénom
                </text>
                <br />
                <text class="info pleftClient">
                    @Html.DisplayFor(model => model.PrenomClient)
                </text>
                <br class="brClient" />
                <text class="labell  pleftClient">
                    Nom
                </text>
                <br />
                <text class="info   pleftClient">
                    @Html.DisplayFor(model => model.NomClient)
                </text>
                <br class="brClient" />
                <text class="labell pleftClient ">
                    Compagnie
                </text>
                <br />
                <text class="info  pleftClient">
                    @Html.DisplayFor(model => model.Compagnie)
                </text>
                <br class="brClient" />
            </div>
            <div class="col-md-6 col-lg-6">

                <br class="brClient" />
                <div class="float-left" style="display:inline;text-align:left">
                    <text class="info pleftClient" onclick="displayCalendar()" data-toggle="modal" data-target="#myModal" style="font-size:15px;font-weight:bolder;">FIXER UN R.-V.</text>
                    <img src="~/Content/Images/ICONES_SVG_NB_Base_RDV.svg" height="20" width="20" style="margin-left:3px;" />
                </div>
                <br />
                <br />
                <text class="labell pleftClient">
                    Langue
                </text>
                <br />
                <text class="info pleftClient">
                    @Html.DisplayFor(model => model.Langue)
                </text>
                <br class="brClient" />
                <text class="labell pleftClient">
                    Ville
                </text>
                <br />
                <text class="info">
                    @Html.DisplayFor(model => model.Ville)
                </text>
                <br class="brClient" />
                <text class="labell pleftClient">
                    No de fiche
                </text>
                <br />
                <text class="info pleftClient">
                    @Html.DisplayFor(model => model.ClientId)
                </text>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 col-lg-12">

                <div class="labell pleftClient">
                    Courriel
                </div>
                <br />
                <div id="input-container">
                    <input value="@Model.Courriel" class="phoneInput float-left" id="IdphoneInput" style="display:block;" />
                </div>
                <br class="brClientPhone" />

                <div class="labell pleftClient float-left">
                    Téléphone residence
                </div>
                <br />
                <div id="input-container">
                    <input value="@Model.Phone1" class="phoneInput float-left" id="IdphoneInput1" style="display:block;" />
                    <img class="float-left" src="~/Content/Images/ICONES_SVG_Base_Couleurs_Appel_Vert.svg" style=" margin-left: -63px; margin-top: 3px; width: 22px; height:22px" />
                    <a href="#">
                        <i class="fas fa-trash-alt float-left" style=" margin-left: -40px; margin-top: 6px; width: 30px;height:30px; color: black;"></i>
                    </a>
                </div>
                <br class="brClientPhone" />

                <div class="labell pleftClient float-left">
                    Téléphone travail
                </div>
                <br />
                <div id="input-container">
                    <input value="@Model.Phone2" class="phoneInput float-left" id="IdphoneInput2" style="display:block;" />
                    <img class="float-left" src="~/Content/Images/ICONES_SVG_Base_Couleurs_Appel_Vert.svg" style=" margin-left: -63px; margin-top: 3px; width: 22px; height:22px" />
                    <a href="#">
                        <i class="fas fa-trash-alt float-left" style=" margin-left: -40px; margin-top: 6px; width: 30px;height:30px; color: black;"></i>
                    </a>
                </div>
                <br class="brClientPhone" />

                <div class="labell pleftClient float-left">
                    Cellulaire
                </div>
                <br />
                <div id="input-container">
                    <input value="@Model.Mobile" class="phoneInput float-left" id="IdphoneInput3" style="display:block;" />
                    <img class="float-left" src="~/Content/Images/ICONES_SVG_Base_Couleurs_Appel_Vert.svg" style=" margin-left: -63px; margin-top: 3px; width: 22px; height:22px" />
                    <a href="#">
                        <i class="fas fa-trash-alt float-left" style=" margin-left: -40px; margin-top: 6px; width: 30px;height:30px; color: black;"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="messageDiv">
                <div class="labell pleftClient" style="color:black;">
                    Cellulaire pour envoi sms
                </div>
                <br />
                <div id="input-container">

                    <input value="@Model.Phone2" class="phoneInput float-left" id="IdphoneInput" style="width:80%;" />
                </div>
                <br class="brClientPhone" />


                <div class="labell pleftClient" style="color:black;">
                    Message Texte à envoyer
                </div>
                <br />
                <div id="input-container">
                    <input value="@Model.Phone2" class="phoneInput float-left" id="IdphoneInput" style="width:95%;" />
                </div>
                <br class="brClientPhone" />
                <div class="saveDiv">
                    <button value="sauvegarder" class="btn  saveButton">Sauvegarder</button>
                </div>
            </div>
        </div>


        <div class="row">

            <div class="box box-content" style="margin-left: 15px;height:150px;">
                <b>  Messages textes antesieurs</b>
            </div>
        </div>

    </div>


    <div class="col-md-4 col-lg-4">
        <div class="row">
            <div class="col-md-6 col-lg-6">
                <br class="brClient" />
                <br />
                <div class="labell">
                    VÉHICULE ACTUEL
                </div>
                <br />
                <text class="labell">
                    Marque
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.Marque
                </text>

                <br class="brClient" />

                <text class="labell">
                    Modele
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.Modele
                </text>

                <br class="brClient" />


                <text class="labell">
                    Annee
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.Annee
                </text>

                <br />

                <text class="labell">
                    Valeur de vehicule
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.ValeurVehicule
                </text>

                <br class="brClient" />


                <text class="labell">
                    Sold à payer
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.SoldAPayer
                </text>

            </div>
            <div class="col-md-6 col-lg-6">
                <br class="brClient" />
                <br />
                <br />
                <text class="labell">
                    No série
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.Niv
                </text>

                <br class="brClient" />

                <text class="labell">
                    Date d'achat
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.DateAcquisition
                </text>

                <br class="brClient" />


                <text class="labell">
                    Terme
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.Terme
                </text>

                <br />

                <text class="labell">
                    Date de fin du terme
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.FinTerme
                </text>

                <br class="brClient" />


                <text class="labell">
                    État de vente
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.EtatVente
                </text>
                <br class="brClient" />


                <text class="labell">
                    Type d'achat
                </text>
                <br />
                <text class="info">
                    @Model.Vehicule.TypeAchat
                </text>
            </div>
        </div>



        <div class="row">
            <div class="col-md-12 col-lg-12" style="display:flex;flex-direction:column;">
                <div style="height:35px"></div>
                <div class="labell pleftClient" style="padding-left:0px;">
                    vehicule désiré <br />
                    Marque/Modèle/Année
                    <br />
                </div>

                <div id="input-container">

                    <input type="text" value="@Model.Vehicule.VehiculeDesire" class="phoneInput float-left" id="IdphoneInput" />
                </div>
                <br class="brClientPhone" />

            </div>
        </div>


        <div class="row">

            <div class="box box-content" style="height:180px;margin-left: 15px;margin-bottom:15px;">
                <b><label>  Données d'avant modifications :</label> </b>
                <br />
                <label> Téléphone residence : </label>
                <br />
                <label> Téléphone travail : </label>
                <br />
                <label> Téléphone cellulaire : </label>
                <br />
                <label>  Courriel : </label>
                <br />
            </div>

            <div class="box box-content" style="height:160px;margin-left: 15px;margin-bottom:15px;">
                <b>  Notes générales</b>
            </div>

            @*<div class="box box-content" style="margin-left: 15px;">
                    <b>  Note du centre d'appels</b>
                </div>*@
        </div>
    </div>


    <div class="col-md-4 col-lg-4">
        <br />

        <div class="row">
            <div class="box box-content">
                <b>Notes d'appels précédents </b>
            </div>
        </div>
        <br />
        <div class="row checkMarksDiv " style="width:100%">

            <div class="col-md-6">
                <label class="checkContainer" style="font-size:15px">
                    RÉSULTAT
                </label>


                <label>
                    <input type="checkbox" name="resultat" value="retourAppel">
                    <span onclick="displayCalendar()" data-toggle="modal" data-target="#myModal">Retour D'appel</span>
                </label>

                <label>
                    <input type="checkbox" name="resultat" value="nonInterresse">
                    <span>Non Intèrressé</span>
                </label>

                <label>
                    <input type="checkbox" name="resultat" value="relanceFuture">
                    <span>Relance Future</span>
                </label>
            </div>
            <div class="col-md-6 rbColumn">
                <label class="topRadio">
                    <input type="checkbox" name="resultat" value="listeNoire">
                    <span>Liste Noire</span>
                </label>

                <label>
                    <input type="checkbox" name="resultat" value="desactivee">
                    <span>Désactivé</span>
                </label>


                <label>
                    <input type="checkbox" name="resultat" value="casLitige">
                    <span>Cas de Litige</span>
                </label>

                <label>
                    <input type="checkbox" name="resultat" value="rvFixee">
                    <span onclick="displayCalendar()" data-toggle="modal" data-target="#myModal">R-V fixé</span>
                </label>

            </div>
        </div>
        <div style="position: relative;margin-left: -15px;width: 100%;">
            <span id="dropdown" class="dropdown dropdown-desactivee" style="position: absolute;top: 100%;left: 0;width: 100%;border-radius: 15px;display: none;">
                <input type="radio" name="resultatDesactivee" value="décédé" id="decede" class="desa">
                <label for="decede">Décédé</label>
                <input type="radio" name="resultatDesactivee" value="déménagé" id="demenage" class="desa">
                <label for="demenage">Déménagé</label>
                <input type="radio" name="resultatDesactivee" value="incapacité" id="incapacite" class="desa">
                <label for="incapacite">Incapacité de conduire un véhicule</label>
                <input type="radio" name="resultatDesactivee" value="pasDePermis" id="pasDePermis" checked="checked" class="desa">
                <label for="pasDePermis">N'a plus de pemis de conduire</label>
            </span>
        </div>

        <div style="position: relative;margin-left: -15px;width: 100%;">
            <span id="dropdown" class="dropdown dropdown-relanceFuture" style="position: absolute; top: 100%; left: 0; width: 100%; border-radius: 15px; display: none;">
                <input type="radio" name="resultatRelanceFuture" value="1" checked="checked" id="unMois">
                <label for="unMois">1 mois</label>
                <input type="radio" name="resultatRelanceFuture" value="2" id="deuxMois">
                <label for="deuxMois">2 mois</label>
                <input type="radio" name="resultatRelanceFuture" value="3" id="troisMois">
                <label for="troisMois">3 mois</label>
                <input type="radio" name="resultatRelanceFuture" value="4" id="quatreMois">
                <label for="quatreMois">4 mois</label>
                <input type="radio" name="resultatRelanceFuture" value="5" id="cinqMois">
                <label for="cinqMois">5 mois</label>
                <input type="radio" name="resultatRelanceFuture" value="6" id="sixMois">
                <label for="sixMois">6 mois</label>
            </span>
        </div>

        <div class="row">
            <div class="box box-content" style="height:250px;">
                @*<div class="float-left" ><b>Note d'appel :</b></div>*@

                <textarea class="float-left "
                          placeholder="Écrire la note d'appel ici"
                          id="AppelsPrecedents"
                          name="Note" rows="55">@Html.DisplayFor(model => model.NoteAppel)</textarea>

            </div>

        </div>
        <br />
        <div style="display:flex;justify-content:center;">
            <button value="sauvegarder" class="btn btn-danger" disabled style="color:white;width:200px;border-radius:15px;">Sauvegarder</button>
        </div>
        <div class="row resultCall" style="margin-top:10px;width:100%;background-color:black;border-radius:15px;height:200px;border-radius:15px;">
            <div class="col-md-6" style="display:flex;flex-direction:column;justify-content:center;">
                <img src="~/Content/Images/ICONES_SVG_Base_Couleurs_Litige.svg" height="150" width="150" />
            </div>
            <div class="col-md-6" id="resultDate" style="display:flex;flex-direction:column;justify-content:center;">
                <p id="resultText" style="color:white;font-size:15px;text-align:center;">liste Noire</p>
                <br />
                <p id="Datenow" style="color:white;font-size:15px;text-align:center;"></p>
            </div>
        </div>
        @*</div>*@
    </div>

</div>


<!--Calendar Modal -->
<div id="myModal" class="modal modal-wide fade" role="dialog">
    <div class="modal-dialog modal-xl">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="display:none;">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Calendrier des rendez Vous</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="removeBackdrop()">Fermer</button>
            </div>
        </div>

    </div>
</div>



<script>
    function removeBackdrop() {
        $('.modal-backdrop').remove();
        if ($('.checkMarksDiv input:checkbox').is(":checked")){
            $('.checkMarksDiv input:checkbox').prop("checked", false);
        }
    }
    function EditClientDetails() {
        $.ajax({
            url: '/Home/EditMainClient',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            success: function (result) {
                $('#' + row).html(result);
                $('#' + row).css('visibility', 'visible');
                $('#' + row).css('display', '');
            },
            error: function (xhr, status) {
                alert(status);
            }
        });
    }


    function displayCalendar(str) {
       // console.log(str);
        $.ajax({
            url: '/Home/GetCalendar',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            success: function (result) {
                $('.modal-body').html(result);
                daysCalendarDisplay();
                monthsCalendarDisplay();
                $('.modal-body').modal("show");
            },
            error: function (xhr, status) {
                alert(status);
            }
        });
    }

    function getRVevents() {
        $.ajax({
            url: '../Home/GetReservations',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            success: function (result) {

                console.log(result);
                return result;
            },
            error: function (xhr, status) {
                alert(status);
            }
        });
    }

    function daysCalendarDisplay() {
        //var events = getRVevents();
       // console.log($("#eventStartDate").text());
        //console.log($("#eventEndDate").text());
        var calendarEl = document.getElementById('calendarfc');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            themeSystem: 'bootstrap',
            allDaySlot: false,
            locale: 'fr',
            timeZone: 'UTC',
            initialView: 'timeGridFourDay',
            eventMaxStack: 3,
            headerToolbar : false,
            //headerToolbar: {
            //    left: 'prev,next',
            //    center: 'title',
            //    right: 'timeGridDay,timeGridFourDay,timeGridWeek,dayGridMonth'
            //},
            views: {
                timeGridFourDay: {
                    type: 'timeGrid',
                    duration: { days: 4 },
                    buttonText: '4 Jours',
                    dayMaxEventRows: 3,
                },
                timeGridDay: {
                    dayMaxEventRows: 5
                }
            },
            events: '../Home/GetReservations',
            selectable: true,
            expandRows: true,

            slotMinTime: "09:00:00",

            slotMaxTime: "20:00:00",

            slotDuration: '00:30:00',

            slotLabelInterval: 30,

            //slotMinutes: 15,

            snapDuration: '00:30:00',
            select: function (info) {
                //console.log(info);

                //alert('selected ' + info.startStr + ' to ' + info.endStr);
                var newEvent = new Object();
                //var title = prompt('Enter Title');
                newEvent.title = 'abc';
                newEvent.start = moment(info.startStr).format();
                newEvent.end = moment(info.endStr).format();
                var midnight = "0:00:00";
                end = moment(info.endStr).format("H:mm:ss");
                if (end === midnight) {
                    newEvent.allDay = true;
                }
                else newEvent.allDay = false;
                saveNewRV(newEvent);
                console.log(newEvent);
                calendar.addEvent(newEvent);
                calendar.unselect();
            },
            editable: true,
            dayMaxEventRows: true,
            
            // events: 'https://fullcalendar.io/demo-events.json'
        });


        calendar.render();
    };


    function saveNewRV(newRV) {
        $.ajax({
            url: '../Home/SaveRendezVous',
            type: 'POST',
            data: JSON.stringify(newRV),
            contentType: 'application/json; charset=utf-8',
            success: function (result) {

                console.log(result);
                return result;
            },
            error: function (xhr, status) {
                alert(status);
            }
        });
    }

    function monthsCalendarDisplay() {
        //'use strict';
        $.datepicker.setDefaults($.datepicker.regional["fr"]);
        var checkIn, checkOut, numberOfMonths = [3, 1],
            $calendar = $('#monthsCalendar').datepicker({
                monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
                dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
                dayNamesShort: ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'],
                dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],
                numberOfMonths: numberOfMonths,
                prevText: '',
                nextText: '',
                beforeShowDay: function (date) {
                    date = moment(date);

                    var now = moment(),
                        show = date.isAfter(now),
                        css = '';

                    if (checkIn && checkOut
                        && date.isSameOrAfter(checkIn)
                        && date.isSameOrBefore(checkOut)) {
                        css = 'ui-datepicker-reserved';

                        if (date.isSame(checkIn)) css += ' ui-datepicker-checkin';
                        if (date.isSame(checkOut)) css += ' ui-datepicker-checkout';
                    }

                    return [show, css];
                },
                onSelect: function (value) {
                    var date = moment($calendar.datepicker('getDate'));

                    if (checkIn && !checkOut
                        && date.isSameOrAfter(checkIn))
                        checkOut = date;
                    else {
                        checkIn = date;
                        checkOut = null;
                    }

                    $('#check-in-date').text(checkIn ? checkIn.format('DD/MM/YYYY') : 'Choose a date');
                    $('#check-out-date').text(checkOut ? checkOut.format('DD/MM/YYYY') : 'Choose a date');
                },
                onChangeMonthYear: function () {
                    $calendar.addClass('fade-in');
                }
            }).on('animationend webkitAnimationEnd', function () {
                $calendar.removeClass('fade-in');
            });

        // resize();

    }

    $('.checkMarksDiv input:checkbox').click(function (e) {


        
        var $box = $(this);
        console.log($box.is(":checked"));
        if ($box.is(":checked")) {
            var group = "input:checkbox[name='" + $box.attr("name") + "']";
            $(group).prop("checked", false);
            $box.prop("checked", true);

            if ($(this).val() != 'desactivee' && $(this).val() != 'relanceFuture') {
                $('.dropdown-relanceFuture').css('display', 'none');
                $('.dropdown-desactivee').css('display', 'none');
            }
            if ($(this).val() === 'desactivee') {
                $('.dropdown-relanceFuture').css('display', 'none');
                $('.dropdown-desactivee').css('display', '');
                $('.dropdown-desactivee').css('visibility', 'visible');
            } else if ($(this).val() === 'relanceFuture') {
                $('.dropdown-desactivee').css('display', 'none');
                $('.dropdown-relanceFuture').css('display', '');
                $('.dropdown-relanceFuture').css('visibility', 'visible');
            } else if ($(this).val() === 'rvFixee') {
                displayCalendar();
            }
            else if ($(this).val() === 'retourAppel') {
                displayCalendar();
            }


        } else {
            $box.prop("checked", false);

            if ($(this).val() === 'desactivee') {
                $('.dropdown-desactivee').css('display', 'none');
                //$('.dropdown-desactivee').css('visibility', 'visible');
            } else if ($(this).val() === 'relanceFuture') {
                $('.dropdown-relanceFuture').css('display', 'none');
                // $('.dropdown-relanceFuture').css('visibility', 'visible');
            }
        }



    });

    $('.dropdown-desactivee').click(function (e) {
        e.preventDefault();
        e.stopPropagation();

        if ($('.dropdown-desactivee').hasClass("expanded")) {
            if ($(e.target).attr('for') != undefined) {
                $('.dropdown-desactivee').css('display', 'none');
            }
            console.log($(e.target).attr('for'));
            var dateTimeNow = moment().format('YYYY-MM-DD HH-MM-SS')
            console.log(dateTimeNow);
            $('#Datenow').html(dateTimeNow);
        }


        $(this).toggleClass('expanded');
        $('#' + $(e.target).attr('for')).prop('checked', true);
    });


    $('.dropdown-relanceFuture').click(function (e) {
        e.preventDefault();
        e.stopPropagation();

        if ($('.dropdown-relanceFuture').hasClass("expanded")) {
            if ($(e.target).attr('for') != undefined) {
                $('.dropdown-relanceFuture').css('display', 'none');
            }
            console.log($(e.target).attr('for'));
            var dateTimeNow = moment().format('YYYY-MM-DD HH-MM-SS')
            //console.log(dateTimeNow);
            $('#Datenow').html(dateTimeNow);
        }


        $(this).toggleClass('expanded');
        $('#' + $(e.target).attr('for')).prop('checked', true);
    });



    $(document).click(function () {
        $('.dropdown-desactivee').removeClass('expanded');
    });


</script>